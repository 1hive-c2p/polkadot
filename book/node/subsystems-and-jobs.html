<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Subsystems and Jobs - The Polkadot Parachain Host Implementers&#x27; Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../last-changed.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Preamble</a></li><li class="chapter-item expanded "><a href="../whence-parachains.html"><strong aria-hidden="true">1.</strong> Whence Parachains</a></li><li class="chapter-item expanded "><a href="../protocol-overview.html"><strong aria-hidden="true">2.</strong> Protocol Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol-approval.html"><strong aria-hidden="true">2.1.</strong> Approval Process</a></li><li class="chapter-item expanded "><a href="../protocol-disputes.html"><strong aria-hidden="true">2.2.</strong> Disputes Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../disputes-flow.html"><strong aria-hidden="true">2.2.1.</strong> Dispute Flow</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol-chain-selection.html"><strong aria-hidden="true">2.3.</strong> Chain Selection and Finalization</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture.html"><strong aria-hidden="true">3.</strong> Architecture Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../messaging.html"><strong aria-hidden="true">3.1.</strong> Messaging Overview</a></li><li class="chapter-item expanded "><a href="../pvf-prechecking.html"><strong aria-hidden="true">3.2.</strong> PVF Pre-checking</a></li></ol></li><li class="chapter-item expanded "><a href="../runtime/index.html"><strong aria-hidden="true">4.</strong> Runtime Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../runtime/initializer.html"><strong aria-hidden="true">4.1.</strong> Initializer Module</a></li><li class="chapter-item expanded "><a href="../runtime/configuration.html"><strong aria-hidden="true">4.2.</strong> Configuration Module</a></li><li class="chapter-item expanded "><a href="../runtime/shared.html"><strong aria-hidden="true">4.3.</strong> Shared</a></li><li class="chapter-item expanded "><a href="../runtime/disputes.html"><strong aria-hidden="true">4.4.</strong> Disputes Module</a></li><li class="chapter-item expanded "><a href="../runtime/paras.html"><strong aria-hidden="true">4.5.</strong> Paras Module</a></li><li class="chapter-item expanded "><a href="../runtime/scheduler.html"><strong aria-hidden="true">4.6.</strong> Scheduler Module</a></li><li class="chapter-item expanded "><a href="../runtime/inclusion.html"><strong aria-hidden="true">4.7.</strong> Inclusion Module</a></li><li class="chapter-item expanded "><a href="../runtime/parainherent.html"><strong aria-hidden="true">4.8.</strong> ParaInherent Module</a></li><li class="chapter-item expanded "><a href="../runtime/dmp.html"><strong aria-hidden="true">4.9.</strong> DMP Module</a></li><li class="chapter-item expanded "><a href="../runtime/ump.html"><strong aria-hidden="true">4.10.</strong> UMP Module</a></li><li class="chapter-item expanded "><a href="../runtime/hrmp.html"><strong aria-hidden="true">4.11.</strong> HRMP Module</a></li><li class="chapter-item expanded "><a href="../runtime/session_info.html"><strong aria-hidden="true">4.12.</strong> Session Info Module</a></li></ol></li><li class="chapter-item expanded "><a href="../runtime-api/index.html"><strong aria-hidden="true">5.</strong> Runtime APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../runtime-api/validators.html"><strong aria-hidden="true">5.1.</strong> Validators</a></li><li class="chapter-item expanded "><a href="../runtime-api/validator-groups.html"><strong aria-hidden="true">5.2.</strong> Validator Groups</a></li><li class="chapter-item expanded "><a href="../runtime-api/availability-cores.html"><strong aria-hidden="true">5.3.</strong> Availability Cores</a></li><li class="chapter-item expanded "><a href="../runtime-api/persisted-validation-data.html"><strong aria-hidden="true">5.4.</strong> Persisted Validation Data</a></li><li class="chapter-item expanded "><a href="../runtime-api/session-index.html"><strong aria-hidden="true">5.5.</strong> Session Index</a></li><li class="chapter-item expanded "><a href="../runtime-api/validation-code.html"><strong aria-hidden="true">5.6.</strong> Validation Code</a></li><li class="chapter-item expanded "><a href="../runtime-api/candidate-pending-availability.html"><strong aria-hidden="true">5.7.</strong> Candidate Pending Availability</a></li><li class="chapter-item expanded "><a href="../runtime-api/candidate-events.html"><strong aria-hidden="true">5.8.</strong> Candidate Events</a></li><li class="chapter-item expanded "><a href="../runtime-api/disputes-info.html"><strong aria-hidden="true">5.9.</strong> Disputes Info</a></li><li class="chapter-item expanded "><a href="../runtime-api/candidates-included.html"><strong aria-hidden="true">5.10.</strong> Candidates Included</a></li><li class="chapter-item expanded "><a href="../runtime-api/pvf-prechecking.html"><strong aria-hidden="true">5.11.</strong> PVF Pre-checking</a></li></ol></li><li class="chapter-item expanded "><a href="../node/index.html"><strong aria-hidden="true">6.</strong> Node Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/subsystems-and-jobs.html" class="active"><strong aria-hidden="true">6.1.</strong> Subsystems and Jobs</a></li><li class="chapter-item expanded "><a href="../node/overseer.html"><strong aria-hidden="true">6.2.</strong> Overseer</a></li><li class="chapter-item expanded "><a href="../node/grandpa-voting-rule.html"><strong aria-hidden="true">6.3.</strong> GRANDPA Voting Rule</a></li><li class="chapter-item expanded "><a href="../node/collators/index.html"><strong aria-hidden="true">6.4.</strong> Collator Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/collators/collation-generation.html"><strong aria-hidden="true">6.4.1.</strong> Collation Generation</a></li><li class="chapter-item expanded "><a href="../node/collators/collator-protocol.html"><strong aria-hidden="true">6.4.2.</strong> Collator Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="../node/backing/index.html"><strong aria-hidden="true">6.5.</strong> Backing Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/backing/candidate-backing.html"><strong aria-hidden="true">6.5.1.</strong> Candidate Backing</a></li><li class="chapter-item expanded "><a href="../node/backing/statement-distribution.html"><strong aria-hidden="true">6.5.2.</strong> Statement Distribution</a></li></ol></li><li class="chapter-item expanded "><a href="../node/availability/index.html"><strong aria-hidden="true">6.6.</strong> Availability Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/availability/availability-distribution.html"><strong aria-hidden="true">6.6.1.</strong> Availability Distribution</a></li><li class="chapter-item expanded "><a href="../node/availability/availability-recovery.html"><strong aria-hidden="true">6.6.2.</strong> Availability Recovery</a></li><li class="chapter-item expanded "><a href="../node/availability/bitfield-distribution.html"><strong aria-hidden="true">6.6.3.</strong> Bitfield Distribution</a></li><li class="chapter-item expanded "><a href="../node/availability/bitfield-signing.html"><strong aria-hidden="true">6.6.4.</strong> Bitfield Signing</a></li></ol></li><li class="chapter-item expanded "><a href="../node/approval/index.html"><strong aria-hidden="true">6.7.</strong> Approval Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/approval/approval-voting.html"><strong aria-hidden="true">6.7.1.</strong> Approval Voting</a></li><li class="chapter-item expanded "><a href="../node/approval/approval-distribution.html"><strong aria-hidden="true">6.7.2.</strong> Approval Distribution</a></li></ol></li><li class="chapter-item expanded "><a href="../node/disputes/index.html"><strong aria-hidden="true">6.8.</strong> Disputes Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/disputes/dispute-coordinator.html"><strong aria-hidden="true">6.8.1.</strong> Dispute Coordinator</a></li><li class="chapter-item expanded "><a href="../node/disputes/dispute-distribution.html"><strong aria-hidden="true">6.8.2.</strong> Dispute Distribution</a></li></ol></li><li class="chapter-item expanded "><a href="../node/utility/index.html"><strong aria-hidden="true">6.9.</strong> Utility Subsystems</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../node/utility/availability-store.html"><strong aria-hidden="true">6.9.1.</strong> Availability Store</a></li><li class="chapter-item expanded "><a href="../node/utility/candidate-validation.html"><strong aria-hidden="true">6.9.2.</strong> Candidate Validation</a></li><li class="chapter-item expanded "><a href="../node/utility/provisioner.html"><strong aria-hidden="true">6.9.3.</strong> Provisioner</a></li><li class="chapter-item expanded "><a href="../node/utility/network-bridge.html"><strong aria-hidden="true">6.9.4.</strong> Network Bridge</a></li><li class="chapter-item expanded "><a href="../node/utility/gossip-support.html"><strong aria-hidden="true">6.9.5.</strong> Gossip Support</a></li><li class="chapter-item expanded "><a href="../node/utility/misbehavior-arbitration.html"><strong aria-hidden="true">6.9.6.</strong> Misbehavior Arbitration</a></li><li class="chapter-item expanded "><a href="../node/utility/peer-set-manager.html"><strong aria-hidden="true">6.9.7.</strong> Peer Set Manager</a></li><li class="chapter-item expanded "><a href="../node/utility/runtime-api.html"><strong aria-hidden="true">6.9.8.</strong> Runtime API Requests</a></li><li class="chapter-item expanded "><a href="../node/utility/chain-api.html"><strong aria-hidden="true">6.9.9.</strong> Chain API Requests</a></li><li class="chapter-item expanded "><a href="../node/utility/chain-selection.html"><strong aria-hidden="true">6.9.10.</strong> Chain Selection Request</a></li><li class="chapter-item expanded "><a href="../node/utility/pvf-prechecker.html"><strong aria-hidden="true">6.9.11.</strong> PVF Pre-Checking</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../types/index.html"><strong aria-hidden="true">7.</strong> Data Structures and Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../types/candidate.html"><strong aria-hidden="true">7.1.</strong> Candidate</a></li><li class="chapter-item expanded "><a href="../types/backing.html"><strong aria-hidden="true">7.2.</strong> Backing</a></li><li class="chapter-item expanded "><a href="../types/availability.html"><strong aria-hidden="true">7.3.</strong> Availability</a></li><li class="chapter-item expanded "><a href="../types/overseer-protocol.html"><strong aria-hidden="true">7.4.</strong> Overseer and Subsystem Protocol</a></li><li class="chapter-item expanded "><a href="../types/runtime.html"><strong aria-hidden="true">7.5.</strong> Runtime</a></li><li class="chapter-item expanded "><a href="../types/chain.html"><strong aria-hidden="true">7.6.</strong> Chain</a></li><li class="chapter-item expanded "><a href="../types/messages.html"><strong aria-hidden="true">7.7.</strong> Messages</a></li><li class="chapter-item expanded "><a href="../types/network.html"><strong aria-hidden="true">7.8.</strong> Network</a></li><li class="chapter-item expanded "><a href="../types/approval.html"><strong aria-hidden="true">7.9.</strong> Approvals</a></li><li class="chapter-item expanded "><a href="../types/disputes.html"><strong aria-hidden="true">7.10.</strong> Disputes</a></li><li class="chapter-item expanded "><a href="../types/pvf-prechecking.html"><strong aria-hidden="true">7.11.</strong> PVF Pre-checking</a></li></ol></li><li class="chapter-item expanded "><a href="../glossary.html">Glossary</a></li><li class="chapter-item expanded affix "><a href="../further-reading.html">Further Reading</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Polkadot Parachain Host Implementers&#x27; Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/paritytech/polkadot" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="subsystems-and-jobs"><a class="header" href="#subsystems-and-jobs">Subsystems and Jobs</a></h1>
<p>In this section we define the notions of Subsystems and Jobs. These are guidelines for how we will employ an architecture of hierarchical state machines. We'll have a top-level state machine which oversees the next level of state machines which oversee another layer of state machines and so on. The next sections will lay out these guidelines for what we've called subsystems and jobs, since this model applies to many of the tasks that the Node-side behavior needs to encompass, but these are only guidelines and some Subsystems may have deeper hierarchies internally.</p>
<p>Subsystems are long-lived worker tasks that are in charge of performing some particular kind of work. All subsystems can communicate with each other via a well-defined protocol. Subsystems can't generally communicate directly, but must coordinate communication through an <a href="overseer.html">Overseer</a>, which is responsible for relaying messages, handling subsystem failures, and dispatching work signals.</p>
<p>Most work that happens on the Node-side is related to building on top of a specific relay-chain block, which is contextually known as the &quot;relay parent&quot;. We call it the relay parent to explicitly denote that it is a block in the relay chain and not on a parachain. We refer to the parent because when we are in the process of building a new block, we don't know what that new block is going to be. The parent block is our only stable point of reference, even though it is usually only useful when it is not yet a parent but in fact a leaf of the block-DAG expected to soon become a parent (because validators are authoring on top of it). Furthermore, we are assuming a forkful blockchain-extension protocol, which means that there may be multiple possible children of the relay-parent. Even if the relay parent has multiple children blocks, the parent of those children is the same, and the context in which those children is authored should be the same. The parent block is the best and most stable reference to use for defining the scope of work items and messages, and is typically referred to by its cryptographic hash.</p>
<p>Since this goal of determining when to start and conclude work relative to a specific relay-parent is common to most, if not all subsystems, it is logically the job of the Overseer to distribute those signals as opposed to each subsystem duplicating that effort, potentially being out of synchronization with each other. Subsystem A should be able to expect that subsystem B is working on the same relay-parents as it is. One of the Overseer's tasks is to provide this heartbeat, or synchronized rhythm, to the system.</p>
<p>The work that subsystems spawn to be done on a specific relay-parent is known as a job. Subsystems should set up and tear down jobs according to the signals received from the overseer. Subsystems may share or cache state between jobs.</p>
<p>Subsystems must be robust to spurious exits. The outputs of the set of subsystems as a whole comprises of signed messages and data committed to disk. Care must be taken to avoid issuing messages that are not substantiated. Since subsystems need to be safe under spurious exits, it is the expected behavior that an <code>OverseerSignal::Conclude</code> can just lead to breaking the loop and exiting directly as opposed to waiting for everything to shut down gracefully.</p>
<h2 id="subsystem-message-traffic"><a class="header" href="#subsystem-message-traffic">Subsystem Message Traffic</a></h2>
<p>Which subsystems send messages to which other subsystems.</p>
<p><strong>Note</strong>: This diagram omits the overseer for simplicity. In fact, all messages are relayed via the overseer.</p>
<p><strong>Note</strong>: Messages with a filled diamond arrowhead (&quot;♦&quot;) include a <code>oneshot::Sender</code> which communicates a response from the recipient.
Messages with an open triangle arrowhead (&quot;Δ&quot;) do not include a return sender.</p>
<div><!-- Generated by graphviz version 2.40.1 (20161225.0304)
 --><!-- Title: %3 Pages: 1 --><svg width="2659pt" height="1292pt"
 viewBox="0.00 0.00 2659.21 1292.46" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1288.4579)"><title>%3</title><polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1288.4579 2655.2076,-1288.4579 2655.2076,4 -4,4"/><!-- av_store --><g id="node1" class="node"><title>av_store</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-1036.4579" rx="90.9839" ry="18"/><text text-anchor="middle" x="2077.5236" y="-1032.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Availability Store</text></g><!-- chn_api --><g id="node9" class="node"><title>chn_api</title><ellipse fill="none" stroke="#000000" cx="2560.8656" cy="-1043.4579" rx="57.6901" ry="18"/><text text-anchor="middle" x="2560.8656" y="-1039.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Chain API</text></g><!-- av_store&#45;&gt;chn_api --><g id="edge2" class="edge"><title>av_store&#45;&gt;chn_api</title><path fill="none" stroke="#000000" d="M2129.6458,-1021.685C2153.4784,-1015.6664 2182.2096,-1009.4324 2208.5236,-1006.4579 2316.2818,-994.2768 2345.544,-988.6942 2452.5236,-1006.4579 2473.7947,-1009.9899 2496.4938,-1017.1728 2515.5906,-1024.2781"/><polygon fill="#000000" stroke="#000000" points="2515.7718,-1024.3478 2522.8082,-1022.7703 2526.9707,-1028.6588 2519.9342,-1030.2363 2515.7718,-1024.3478"/><text text-anchor="middle" x="2330.5236" y="-1010.2579" font-family="Times,serif" font-size="14.00" fill="#000000">BlockNumber</text></g><!-- av_store&#45;&gt;chn_api --><g id="edge3" class="edge"><title>av_store&#45;&gt;chn_api</title><path fill="none" stroke="#000000" d="M2139.8673,-1049.6824C2161.4988,-1053.663 2185.9799,-1057.4939 2208.5236,-1059.4579 2316.5589,-1068.8699 2344.3705,-1067.4009 2452.5236,-1059.4579 2467.412,-1058.3645 2483.3591,-1056.4367 2498.315,-1054.2892"/><polygon fill="#000000" stroke="#000000" points="2498.7325,-1054.2267 2504.073,-1049.3812 2510.5998,-1052.4472 2505.2593,-1057.2927 2498.7325,-1054.2267"/><text text-anchor="middle" x="2330.5236" y="-1069.2579" font-family="Times,serif" font-size="14.00" fill="#000000">BlockHeader</text></g><!-- av_store&#45;&gt;chn_api --><g id="edge5" class="edge"><title>av_store&#45;&gt;chn_api</title><path fill="none" stroke="#000000" d="M2168.8443,-1036.9981C2244.7814,-1037.5515 2355.6935,-1038.601 2452.5236,-1040.4579 2464.9984,-1040.6971 2478.2794,-1041.0137 2491.1122,-1041.3515"/><polygon fill="#000000" stroke="#000000" points="2491.2418,-1041.3549 2497.348,-1037.5189 2503.2374,-1041.68 2497.1313,-1045.516 2491.2418,-1041.3549"/><text text-anchor="middle" x="2330.5236" y="-1044.2579" font-family="Times,serif" font-size="14.00" fill="#000000">FinalizedBlockHash</text></g><!-- runt_api --><g id="node15" class="node"><title>runt_api</title><ellipse fill="none" stroke="#000000" cx="2560.8656" cy="-812.4579" rx="70.3881" ry="18"/><text text-anchor="middle" x="2560.8656" y="-808.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Runtime API</text></g><!-- av_store&#45;&gt;runt_api --><g id="edge1" class="edge"><title>av_store&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M2148.2023,-1025.0732C2163.1593,-1020.3901 2178.1467,-1013.7819 2190.5236,-1004.4579 2202.6401,-995.3302 2195.7425,-983.6289 2208.5236,-975.4579 2300.5801,-916.6057 2356.8893,-998.2978 2452.5236,-945.4579 2495.9382,-921.4705 2528.7193,-872.4025 2546.3277,-841.04"/><polygon fill="#000000" stroke="#000000" points="2546.3966,-840.9129 2545.7426,-833.7315 2552.1201,-830.3658 2552.774,-837.5472 2546.3966,-840.9129"/><text text-anchor="middle" x="2330.5236" y="-979.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::CandidateEvents</text></g><!-- av_store&#45;&gt;runt_api --><g id="edge4" class="edge"><title>av_store&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M2154.2124,-1026.6982C2167.7744,-1021.8719 2180.6825,-1014.7952 2190.5236,-1004.4579 2215.055,-978.6899 2181.5627,-949.6717 2208.5236,-926.4579 2249.7379,-890.9718 2402.405,-928.5766 2452.5236,-907.4579 2487.4655,-892.7343 2519.0103,-862.1434 2538.9319,-839.6357"/><polygon fill="#000000" stroke="#000000" points="2539.1702,-839.3581 2540.0426,-832.2 2546.9857,-830.2522 2546.1133,-837.4103 2539.1702,-839.3581"/><text text-anchor="middle" x="2330.5236" y="-930.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::Validators</text></g><!-- avail_dist --><g id="node2" class="node"><title>avail_dist</title><ellipse fill="none" stroke="#000000" cx="122.1892" cy="-1090.4579" rx="122.3786" ry="18"/><text text-anchor="middle" x="122.1892" y="-1086.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Availability Distribution</text></g><!-- avail_dist&#45;&gt;av_store --><g id="edge9" class="edge"><title>avail_dist&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M405.3783,-1139.4579C602.9693,-1135.2935 646.1588,-1196.1958 841.4631,-1226.4579"/><path fill="none" stroke="#000000" d="M841.4631,-1226.4579C901.7247,-1230.2285 888.2924,-1159.2932 944.9631,-1138.4579 1043.6508,-1102.1747 1077.3902,-1124.0316 1181.5421,-1138.4579 1241.4699,-1146.7586 1252.1207,-1172.3757 1312.5421,-1175.4579"/><text text-anchor="middle" x="1063.2526" y="-1142.2579" font-family="Times,serif" font-size="14.00" fill="#000000">QueryDataAvailability</text></g><!-- avail_dist&#45;&gt;av_store --><g id="edge10" class="edge"><title>avail_dist&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M841.4631,-1226.4579C992.9022,-1237.1178 1030.8006,-1212.4701 1181.5421,-1194.4579 1239.958,-1187.4778 1253.7677,-1172.8695 1312.5421,-1175.4579"/><text text-anchor="middle" x="1063.2526" y="-1231.2579" font-family="Times,serif" font-size="14.00" fill="#000000">QueryChunk</text></g><!-- avail_dist&#45;&gt;av_store --><g id="edge11" class="edge"><title>avail_dist&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M841.4631,-1226.4579C892.6159,-1230.0872 895.0195,-1187.0948 944.9631,-1175.4579 1104.0697,-1138.3859 1149.3283,-1168.3514 1312.5421,-1175.4579"/><text text-anchor="middle" x="1063.2526" y="-1179.2579" font-family="Times,serif" font-size="14.00" fill="#000000">StoreChunk</text></g><!-- avail_dist&#45;&gt;chn_api --><g id="edge13" class="edge"><title>avail_dist&#45;&gt;chn_api</title><path fill="none" stroke="#000000" d="M841.4631,-1226.4579C888.1966,-1229.7737 898.4876,-1240.5383 944.9631,-1246.4579 1107.3392,-1267.1396 1148.8542,-1269.4579 1312.5421,-1269.4579 1312.5421,-1269.4579 1312.5421,-1269.4579 2077.5236,-1269.4579 2265.9694,-1269.4579 2460.1355,-1126.7442 2531.9315,-1068.1331"/><polygon fill="#000000" stroke="#000000" points="2531.986,-1068.0882 2534.0635,-1061.1828 2541.2368,-1060.4446 2539.1592,-1067.35 2531.986,-1068.0882"/><text text-anchor="middle" x="1312.5421" y="-1273.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Ancestors</text></g><!-- net_brdg --><g id="node12" class="node"><title>net_brdg</title><ellipse fill="none" stroke="#000000" cx="652.1707" cy="-736.4579" rx="85.5853" ry="18"/><text text-anchor="middle" x="652.1707" y="-732.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Network Bridge</text></g><!-- avail_dist&#45;&gt;net_brdg --><g id="edge6" class="edge"><title>avail_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M153.7313,-1073.0553C225.8606,-1032.792 407.4856,-928.7371 548.3783,-825.4579 575.9268,-805.2639 605.2994,-779.6517 625.7411,-761.0929"/><polygon fill="none" stroke="#000000" points="628.3661,-763.4353 633.3844,-754.1043 623.6425,-758.2693 628.3661,-763.4353"/><text text-anchor="middle" x="405.3783" y="-1010.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::SendValidationMessages</text></g><!-- avail_dist&#45;&gt;net_brdg --><g id="edge8" class="edge"><title>avail_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M236.866,-1096.7204C354.721,-1102.0437 524.3274,-1106.1751 548.3783,-1087.4579 573.3897,-1067.9932 557.7644,-1048.9578 566.3783,-1018.4579 592.8583,-924.6987 627.4019,-814.4287 643.3702,-764.0611"/><polygon fill="none" stroke="#000000" points="646.7063,-765.1193 646.3973,-754.529 640.0346,-763.0005 646.7063,-765.1193"/><text text-anchor="middle" x="405.3783" y="-1104.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- avail_dist&#45;&gt;runt_api --><g id="edge7" class="edge"><title>avail_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1063.2526,-1027.4579C1124.2215,-1025.8892 1138.7998,-1037.9763 1199.5421,-1043.4579 1353.8862,-1057.3864 1392.5659,-1066.6202 1547.5329,-1065.4579"/><text text-anchor="middle" x="1312.5421" y="-1066.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::AvailabilityCores</text></g><!-- avail_dist&#45;&gt;runt_api --><g id="edge12" class="edge"><title>avail_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1063.2526,-1027.4579C1224.2138,-1022.9937 1266.6303,-998.4678 1425.5421,-1024.4579 1481.9905,-1033.6901 1490.335,-1065.7056 1547.5329,-1065.4579"/><path fill="none" stroke="#000000" d="M1547.5329,-1065.4579C1607.0074,-1065.3886 2019.1289,-1001.7399 2077.5236,-990.4579"/><text text-anchor="middle" x="1312.5421" y="-1028.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::Validators</text></g><!-- avail_dist&#45;&gt;runt_api --><g id="edge14" class="edge"><title>avail_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M181.6189,-1106.2353C238.5708,-1120.0431 327.179,-1138.1117 405.3783,-1139.4579"/><path fill="none" stroke="#000000" d="M405.3783,-1139.4579C701.9299,-1144.5631 766.7881,-1036.2745 1063.2526,-1027.4579"/><path fill="none" stroke="#000000" d="M1063.2526,-1027.4579C1071.0214,-1026.721 1191.7986,-994.4253 1199.5421,-993.4579 1307.1509,-980.0141 1335.0975,-992.8512 1443.5421,-992.4579 1452.3474,-992.426 2068.87,-992.0855 2077.5236,-990.4579"/><text text-anchor="middle" x="1312.5421" y="-997.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::SessionIndexForChild</text></g><!-- avail_rcov --><g id="node3" class="node"><title>avail_rcov</title><ellipse fill="none" stroke="#000000" cx="122.1892" cy="-774.4579" rx="109.381" ry="18"/><text text-anchor="middle" x="122.1892" y="-770.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Availability Recovery</text></g><!-- avail_rcov&#45;&gt;av_store --><g id="edge16" class="edge"><title>avail_rcov&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M126.1865,-792.659C137.7185,-840.3276 175.8994,-968.9576 262.3783,-1024.4579 283.9375,-1038.2941 1157.0962,-1091.8005 1181.5421,-1099.4579 1245.7756,-1119.5782 1245.2949,-1172.5299 1312.5421,-1175.4579"/><path fill="none" stroke="#000000" d="M1312.5421,-1175.4579C1580.1599,-1183.6359 1892.3141,-1095.695 2019.3307,-1055.6736"/><polygon fill="#000000" stroke="#000000" points="2019.6001,-1055.5881 2024.1075,-1049.9592 2031.0369,-1051.955 2026.5295,-1057.5838 2019.6001,-1055.5881"/><text text-anchor="middle" x="1063.2526" y="-1103.2579" font-family="Times,serif" font-size="14.00" fill="#000000">QueryChunk</text></g><!-- avail_rcov&#45;&gt;net_brdg --><g id="edge15" class="edge"><title>avail_rcov&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M170.8836,-758.3259C197.5717,-750.3213 231.4299,-741.5136 262.3783,-737.4579 363.6785,-724.1827 481.0625,-726.2174 560.3294,-730.1214"/><polygon fill="none" stroke="#000000" points="560.6044,-733.64 570.7707,-730.6573 560.9633,-726.6492 560.6044,-733.64"/><text text-anchor="middle" x="405.3783" y="-741.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- avail_rcov&#45;&gt;net_brdg --><g id="edge17" class="edge"><title>avail_rcov&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M149.8568,-756.9249C177.2203,-740.7003 220.8996,-717.7336 262.3783,-708.4579 386.4256,-680.7179 422.3688,-691.7596 548.3783,-708.4579 563.4885,-710.4602 579.5209,-714.0346 594.3495,-717.9742"/><polygon fill="#000000" stroke="#000000" points="594.3792,-717.9824 601.2299,-715.7311 605.9429,-721.189 599.0922,-723.4402 594.3792,-717.9824"/><text text-anchor="middle" x="405.3783" y="-712.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ConnectToValidators</text></g><!-- avail_rcov&#45;&gt;net_brdg --><g id="edge18" class="edge"><title>avail_rcov&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M190.8931,-788.462C276.1126,-803.2434 425.2094,-820.5818 548.3783,-790.4579 573.3594,-784.3482 599.0182,-771.0735 618.574,-759.2155"/><polygon fill="none" stroke="#000000" points="620.4703,-762.1577 627.1053,-753.8977 616.7674,-756.2173 620.4703,-762.1577"/><text text-anchor="middle" x="405.3783" y="-810.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage::Chunk</text></g><!-- avail_rcov&#45;&gt;net_brdg --><g id="edge19" class="edge"><title>avail_rcov&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M230.5854,-771.8935C316.8609,-769.1224 440.5882,-763.5193 548.3783,-752.4579 557.0756,-751.5654 566.1565,-750.4458 575.172,-749.2156"/><polygon fill="none" stroke="#000000" points="575.8866,-752.6495 585.2991,-747.7858 574.908,-745.7182 575.8866,-752.6495"/><text text-anchor="middle" x="405.3783" y="-774.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage::RequestChunk</text></g><!-- bitf_dist --><g id="node4" class="node"><title>bitf_dist</title><ellipse fill="none" stroke="#000000" cx="1547.5329" cy="-877.4579" rx="103.9815" ry="18"/><text text-anchor="middle" x="1547.5329" y="-873.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Bitfield Distribution</text></g><!-- bitf_dist&#45;&gt;net_brdg --><g id="edge20" class="edge"><title>bitf_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1312.5421,-868.4579C1261.9452,-867.4893 1249.1684,-872.5476 1199.5421,-882.4579 1191.4,-884.0839 1189.7689,-886.3365 1181.5421,-887.4579 1077.3593,-901.6589 1049.6764,-896.9896 944.9631,-887.4579 898.387,-883.2182 886.0807,-882.4784 841.4631,-868.4579"/><text text-anchor="middle" x="1063.2526" y="-899.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- bitf_dist&#45;&gt;net_brdg --><g id="edge22" class="edge"><title>bitf_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1312.5421,-868.4579C1312.5421,-868.4579 841.4631,-868.4579 841.4631,-868.4579"/><text text-anchor="middle" x="1063.2526" y="-872.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage</text></g><!-- bitf_dist&#45;&gt;net_brdg --><g id="edge23" class="edge"><title>bitf_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1447.2196,-872.5338C1408.7413,-870.905 1364.1312,-869.3272 1322.716,-868.6158"/><polygon fill="none" stroke="#000000" points="1322.5952,-865.1136 1312.5421,-868.4579 1322.4866,-872.1127 1322.5952,-865.1136"/><path fill="none" stroke="#000000" d="M1312.5421,-868.4579C1253.7471,-866.3886 1240.221,-853.6911 1181.5421,-849.4579 1076.6684,-841.8921 1049.6764,-839.9262 944.9631,-849.4579 898.387,-853.6976 886.3262,-881.6719 841.4631,-868.4579"/><path fill="none" stroke="#000000" d="M841.4631,-868.4579C768.8263,-847.0635 700.2667,-785.3114 669.3554,-754.4536"/><text text-anchor="middle" x="1063.2526" y="-853.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage</text></g><!-- provisioner --><g id="node14" class="node"><title>provisioner</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-760.4579" rx="63.8893" ry="18"/><text text-anchor="middle" x="2077.5236" y="-756.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Provisioner</text></g><!-- bitf_dist&#45;&gt;provisioner --><g id="edge21" class="edge"><title>bitf_dist&#45;&gt;provisioner</title><path fill="none" stroke="#000000" d="M1621.9859,-864.888C1633.0044,-860.2771 1643.3734,-853.9991 1651.5236,-845.4579 1673.7001,-822.2177 1644.5037,-795.6049 1669.5236,-775.4579 1694.853,-755.0617 1893.5431,-756.2 2004.0199,-758.4794"/><polygon fill="none" stroke="#000000" points="2004.028,-761.9803 2014.1008,-758.6956 2004.1782,-754.9819 2004.028,-761.9803"/><text text-anchor="middle" x="1808.0236" y="-779.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ProvisionableData::Bitfield</text></g><!-- bitf_dist&#45;&gt;runt_api --><g id="edge24" class="edge"><title>bitf_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1634.5815,-887.3255C1685.1639,-892.8478 1750.1455,-899.581 1808.0236,-904.4579"/><path fill="none" stroke="#000000" d="M1808.0236,-904.4579C1865.881,-909.333 2273.9067,-909.3328 2330.5236,-896.4579"/><text text-anchor="middle" x="2077.5236" y="-911.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::Validatiors</text></g><!-- bitf_dist&#45;&gt;runt_api --><g id="edge25" class="edge"><title>bitf_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1808.0236,-904.4579C1877.8914,-911.0596 1894.5007,-920.7808 1964.5236,-925.4579 2064.7448,-932.152 2096.0786,-959.6517 2190.5236,-925.4579 2200.3153,-921.9128 2198.9504,-914.5563 2208.5236,-910.4579 2258.6973,-888.9784 2277.3701,-908.8462 2330.5236,-896.4579"/><text text-anchor="middle" x="2077.5236" y="-945.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::SessionIndexForChild</text></g><!-- bitf_sign --><g id="node5" class="node"><title>bitf_sign</title><ellipse fill="none" stroke="#000000" cx="1063.2526" cy="-970.4579" rx="83.3857" ry="18"/><text text-anchor="middle" x="1063.2526" y="-966.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Bitfield Signing</text></g><!-- bitf_sign&#45;&gt;av_store --><g id="edge26" class="edge"><title>bitf_sign&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M1142.1585,-976.376C1160.9611,-977.7507 1180.9616,-979.1837 1199.5421,-980.4579 1481.7115,-999.808 1815.0523,-1020.4652 1977.8975,-1030.4141"/><polygon fill="#000000" stroke="#000000" points="1978.2961,-1030.4383 1984.5287,-1026.8114 1990.2738,-1031.1696 1984.0412,-1034.7965 1978.2961,-1030.4383"/><text text-anchor="middle" x="1547.5329" y="-1012.2579" font-family="Times,serif" font-size="14.00" fill="#000000">QueryChunkAvailability</text></g><!-- bitf_sign&#45;&gt;bitf_dist --><g id="edge28" class="edge"><title>bitf_sign&#45;&gt;bitf_dist</title><path fill="none" stroke="#000000" d="M1135.1194,-961.2498C1151.6711,-956.4904 1168.2867,-949.302 1181.5421,-938.4579 1195.3877,-927.131 1184.6721,-912.402 1199.5421,-902.4579 1218.8525,-889.5443 1339.9863,-883.1301 1433.9718,-880.0631"/><polygon fill="none" stroke="#000000" points="1434.2471,-883.5562 1444.1312,-879.741 1434.0252,-876.5597 1434.2471,-883.5562"/><text text-anchor="middle" x="1312.5421" y="-906.2579" font-family="Times,serif" font-size="14.00" fill="#000000">DistributeBitfield</text></g><!-- bitf_sign&#45;&gt;runt_api --><g id="edge27" class="edge"><title>bitf_sign&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1120.9614,-957.4782C1145.1068,-952.6732 1173.5485,-947.8222 1199.5421,-945.4579 1299.5736,-936.3593 1325.1095,-943.9161 1425.5421,-945.4579 1657.1713,-949.0139 1716.6539,-932.7414 1946.5236,-961.4579 2005.6955,-968.8499 2018.9126,-1001.4438 2077.5236,-990.4579"/><path fill="none" stroke="#000000" d="M2077.5236,-990.4579C2128.5422,-980.601 2152.2345,-995.5861 2190.5236,-960.4579 2207.9273,-944.491 2190.0074,-925.1199 2208.5236,-910.4579 2251.3117,-876.5765 2277.5186,-909.4666 2330.5236,-896.4579"/><text text-anchor="middle" x="1808.0236" y="-965.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::AvailabilityCores</text></g><!-- cand_back --><g id="node6" class="node"><title>cand_back</title><ellipse fill="none" stroke="#000000" cx="1547.5329" cy="-622.4579" rx="99.3824" ry="18"/><text text-anchor="middle" x="1547.5329" y="-618.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Candidate Backing</text></g><!-- cand_back&#45;&gt;av_store --><g id="edge29" class="edge"><title>cand_back&#45;&gt;av_store</title><path fill="none" stroke="#000000" d="M1564.5475,-640.4199C1586.4803,-662.2539 1626.8954,-698.1932 1669.5236,-714.4579 1727.2331,-736.4768 1903.1879,-693.444 1946.5236,-737.4579 1988.2461,-779.8333 1927.0809,-958.2574 1964.5236,-1004.4579 1970.7299,-1012.1158 1978.6219,-1018.0226 1987.3417,-1022.5666"/><polygon fill="#000000" stroke="#000000" points="1987.3682,-1022.5783 1994.4765,-1021.3647 1998.3307,-1027.4594 1991.2225,-1028.673 1987.3682,-1022.5783"/><text text-anchor="middle" x="1808.0236" y="-741.2579" font-family="Times,serif" font-size="14.00" fill="#000000">StoreAvailableData</text></g><!-- cand_sel --><g id="node7" class="node"><title>cand_sel</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-453.4579" rx="104.7816" ry="18"/><text text-anchor="middle" x="2077.5236" y="-449.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Candidate Selection</text></g><!-- cand_back&#45;&gt;cand_sel --><g id="edge32" class="edge"><title>cand_back&#45;&gt;cand_sel</title><path fill="none" stroke="#000000" d="M1568.3649,-604.7681C1591.4294,-586.3272 1630.5266,-558.3532 1669.5236,-545.4579 1786.7455,-506.6958 1828.0802,-559.3092 1946.5236,-524.4579 1982.0424,-514.0067 2018.7924,-493.049 2044.2947,-476.5995"/><polygon fill="none" stroke="#000000" points="2046.3905,-479.4104 2052.8256,-470.9938 2042.5464,-473.5604 2046.3905,-479.4104"/><text text-anchor="middle" x="1808.0236" y="-549.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Invalid</text></g><!-- cand_val --><g id="node8" class="node"><title>cand_val</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-706.4579" rx="107.781" ry="18"/><text text-anchor="middle" x="2077.5236" y="-702.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Candidate Validation</text></g><!-- cand_back&#45;&gt;cand_val --><g id="edge31" class="edge"><title>cand_back&#45;&gt;cand_val</title><path fill="none" stroke="#000000" d="M1590.651,-606.134C1665.7988,-580.3273 1824.4015,-537.6878 1946.5236,-585.4579 1994.2387,-604.1224 2035.0067,-649.2198 2057.87,-678.7761"/><polygon fill="#000000" stroke="#000000" points="2057.9802,-678.9226 2064.7833,-681.314 2065.1924,-688.5135 2058.3893,-686.1221 2057.9802,-678.9226"/><text text-anchor="middle" x="1808.0236" y="-589.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ValidateFromChainState</text></g><!-- pov_dist --><g id="node13" class="node"><title>pov_dist</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-399.4579" rx="87.9851" ry="18"/><text text-anchor="middle" x="2077.5236" y="-395.7579" font-family="Times,serif" font-size="14.00" fill="#000000">PoV Distribution</text></g><!-- cand_back&#45;&gt;pov_dist --><g id="edge30" class="edge"><title>cand_back&#45;&gt;pov_dist</title><path fill="none" stroke="#000000" d="M1560.0388,-604.1873C1579.9186,-574.9838 1619.7312,-515.8408 1651.5236,-464.4579 1659.9064,-450.9096 1656.0574,-441.9718 1669.5236,-433.4579 1721.7318,-400.45 1884.9705,-415.5976 1946.5236,-410.4579 1958.6748,-409.4433 1971.4596,-408.373 1984.0845,-407.3146"/><polygon fill="#000000" stroke="#000000" points="1984.1558,-407.3087 1989.8005,-402.8212 1996.1139,-406.3057 1990.4692,-410.7932 1984.1558,-407.3087"/><text text-anchor="middle" x="1808.0236" y="-437.2579" font-family="Times,serif" font-size="14.00" fill="#000000">FetchPoV</text></g><!-- cand_back&#45;&gt;pov_dist --><g id="edge35" class="edge"><title>cand_back&#45;&gt;pov_dist</title><path fill="none" stroke="#000000" d="M1555.5692,-604.265C1571.6337,-570.3825 1611.2438,-498.2633 1669.5236,-467.4579 1724.0723,-438.6247 1891.7043,-476.7732 1946.5236,-448.4579 1957.7482,-442.6602 1953.8185,-433.1665 1964.5236,-426.4579 1973.749,-420.6766 1984.1077,-416.1329 1994.7116,-412.5619"/><polygon fill="none" stroke="#000000" points="1995.9671,-415.8375 2004.4933,-409.5483 1993.9061,-409.1478 1995.9671,-415.8375"/><text text-anchor="middle" x="1808.0236" y="-471.2579" font-family="Times,serif" font-size="14.00" fill="#000000">DistributePoV</text></g><!-- cand_back&#45;&gt;provisioner --><g id="edge33" class="edge"><title>cand_back&#45;&gt;provisioner</title><path fill="none" stroke="#000000" d="M1626.8692,-633.4196C1641.0589,-635.2215 1655.7183,-636.9803 1669.5236,-638.4579 1700.2319,-641.7447 1922.9889,-641.46 1946.5236,-661.4579 1971.6596,-682.8164 1941.0784,-710.2561 1964.5236,-733.4579 1975.4022,-744.2235 1989.7595,-750.9793 2004.5775,-755.1565"/><polygon fill="none" stroke="#000000" points="2003.8045,-758.5705 2014.3496,-757.5454 2005.4668,-751.7708 2003.8045,-758.5705"/><text text-anchor="middle" x="1808.0236" y="-665.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ProvisionableData::MisbehaviorReport</text></g><!-- cand_back&#45;&gt;provisioner --><g id="edge34" class="edge"><title>cand_back&#45;&gt;provisioner</title><path fill="none" stroke="#000000" d="M1639.4568,-615.5467C1750.0462,-608.1839 1923.7796,-600.0233 1946.5236,-619.4579 1985.5202,-652.7802 1929.6937,-695.8018 1964.5236,-733.4579 1975.0284,-744.815 1989.3819,-751.7905 2004.335,-755.9903"/><polygon fill="none" stroke="#000000" points="2003.6721,-759.4306 2014.2135,-758.3675 2005.3099,-752.6249 2003.6721,-759.4306"/><text text-anchor="middle" x="1808.0236" y="-623.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ProvisionableData::BackedCandidate</text></g><!-- stmt_dist --><g id="node16" class="node"><title>stmt_dist</title><ellipse fill="none" stroke="#000000" cx="1063.2526" cy="-693.4579" rx="118.0794" ry="18"/><text text-anchor="middle" x="1063.2526" y="-689.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Statement Distribution</text></g><!-- cand_back&#45;&gt;stmt_dist --><g id="edge36" class="edge"><title>cand_back&#45;&gt;stmt_dist</title><path fill="none" stroke="#000000" d="M1503.5012,-638.6451C1480.56,-646.4442 1451.8671,-655.22 1425.5421,-660.4579 1347.6093,-675.9642 1258.7743,-684.1996 1188.576,-688.5656"/><polygon fill="none" stroke="#000000" points="1188.1287,-685.0861 1178.3576,-689.182 1188.5503,-692.0734 1188.1287,-685.0861"/><text text-anchor="middle" x="1312.5421" y="-692.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Share</text></g><!-- cand_sel&#45;&gt;cand_back --><g id="edge38" class="edge"><title>cand_sel&#45;&gt;cand_back</title><path fill="none" stroke="#000000" d="M2024.7477,-469.036C2001.0359,-475.4415 1972.5818,-482.316 1946.5236,-486.4579 1885.5884,-496.1434 1725.9491,-480.4962 1669.5236,-505.4579 1625.2601,-525.0393 1587.3943,-567.956 1566.0564,-596.0104"/><polygon fill="none" stroke="#000000" points="1563.1285,-594.0825 1559.9761,-604.1975 1568.7483,-598.2561 1563.1285,-594.0825"/><text text-anchor="middle" x="1808.0236" y="-509.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Second</text></g><!-- coll_prot --><g id="node11" class="node"><title>coll_prot</title><ellipse fill="none" stroke="#000000" cx="2560.8656" cy="-303.4579" rx="90.1842" ry="18"/><text text-anchor="middle" x="2560.8656" y="-299.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Collator Protocol</text></g><!-- cand_sel&#45;&gt;coll_prot --><g id="edge37" class="edge"><title>cand_sel&#45;&gt;coll_prot</title><path fill="none" stroke="#000000" d="M2164.6172,-443.3923C2174.2442,-439.3144 2183.1964,-433.8211 2190.5236,-426.4579 2215.3139,-401.5459 2182.4636,-373.0383 2208.5236,-349.4579 2281.7952,-283.1582 2401.3185,-281.8174 2480.5272,-290.102"/><polygon fill="#000000" stroke="#000000" points="2480.957,-290.1507 2487.3703,-286.8538 2492.8803,-291.5058 2486.467,-294.8027 2480.957,-290.1507"/><text text-anchor="middle" x="2330.5236" y="-353.2579" font-family="Times,serif" font-size="14.00" fill="#000000">FetchCollation</text></g><!-- cand_sel&#45;&gt;coll_prot --><g id="edge39" class="edge"><title>cand_sel&#45;&gt;coll_prot</title><path fill="none" stroke="#000000" d="M2180.1647,-457.1257C2258.343,-456.0368 2366.7661,-445.9653 2452.5236,-405.4579 2489.2993,-388.087 2521.818,-353.5042 2541.4066,-329.4498"/><polygon fill="none" stroke="#000000" points="2544.3013,-331.4328 2547.7819,-321.426 2538.8207,-327.0781 2544.3013,-331.4328"/><text text-anchor="middle" x="2330.5236" y="-460.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportCollator</text></g><!-- cand_val&#45;&gt;runt_api --><g id="edge40" class="edge"><title>cand_val&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M2163.8054,-717.3386C2178.7099,-719.1202 2194.0589,-720.8931 2208.5236,-722.4579 2316.817,-734.173 2349.263,-710.789 2452.5236,-745.4579 2480.682,-754.9118 2509.1153,-772.8876 2529.7845,-787.8413"/><polygon fill="#000000" stroke="#000000" points="2529.9266,-787.9468 2537.1282,-788.3162 2539.5571,-795.106 2532.3554,-794.7366 2529.9266,-787.9468"/><text text-anchor="middle" x="2330.5236" y="-749.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::PersistedValidationData</text></g><!-- cand_val&#45;&gt;runt_api --><g id="edge41" class="edge"><title>cand_val&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M2139.4258,-691.6758C2216.1679,-676.4932 2349.4306,-660.5724 2452.5236,-703.4579 2491.7133,-719.7603 2524.0338,-757.8926 2542.889,-784.4287"/><polygon fill="#000000" stroke="#000000" points="2543.1113,-784.7529 2549.8036,-787.4386 2549.8985,-794.6491 2543.2061,-791.9634 2543.1113,-784.7529"/><text text-anchor="middle" x="2330.5236" y="-707.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::ValidationCode</text></g><!-- cand_val&#45;&gt;runt_api --><g id="edge42" class="edge"><title>cand_val&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M2159.4065,-718.2212C2170.4472,-721.9868 2181.1741,-726.9418 2190.5236,-733.4579 2202.3558,-741.7041 2196.1417,-753.0629 2208.5236,-760.4579 2255.2817,-788.3838 2398.9193,-773.8274 2452.5236,-783.4579 2469.4874,-786.5056 2487.6728,-790.9127 2504.2071,-795.3749"/><polygon fill="#000000" stroke="#000000" points="2504.3485,-795.414 2511.1981,-793.1595 2515.9136,-798.6151 2509.064,-800.8696 2504.3485,-795.414"/><text text-anchor="middle" x="2330.5236" y="-787.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::CheckValidationOutputs</text></g><!-- coll_gen --><g id="node10" class="node"><title>coll_gen</title><ellipse fill="none" stroke="#000000" cx="2077.5236" cy="-30.4579" rx="107.4815" ry="18"/><text text-anchor="middle" x="2077.5236" y="-26.7579" font-family="Times,serif" font-size="14.00" fill="#000000">Collation Generation</text></g><!-- coll_gen&#45;&gt;coll_prot --><g id="edge43" class="edge"><title>coll_gen&#45;&gt;coll_prot</title><path fill="none" stroke="#000000" d="M2136.2384,-15.3515C2215.6244,1.4254 2358.1021,18.2365 2452.5236,-47.4579 2529.4026,-100.9469 2551.9831,-220.4509 2558.4092,-275.1462"/><polygon fill="none" stroke="#000000" points="2554.9394,-275.6148 2559.4904,-285.1824 2561.8991,-274.865 2554.9394,-275.6148"/><text text-anchor="middle" x="2330.5236" y="-51.2579" font-family="Times,serif" font-size="14.00" fill="#000000">DistributeCollation</text></g><!-- coll_prot&#45;&gt;cand_sel --><g id="edge49" class="edge"><title>coll_prot&#45;&gt;cand_sel</title><path fill="none" stroke="#000000" d="M2536.8469,-320.943C2515.7503,-335.2988 2483.6493,-354.7833 2452.5236,-364.4579 2400.5349,-380.6172 2252.8667,-354.8724 2208.5236,-386.4579 2192.6451,-397.7681 2205.5436,-414.03 2190.5236,-426.4579 2184.7009,-431.2758 2178.1619,-435.2618 2171.2411,-438.5561"/><polygon fill="none" stroke="#000000" points="2169.4461,-435.515 2161.5984,-442.6329 2172.172,-441.9625 2169.4461,-435.515"/><text text-anchor="middle" x="2330.5236" y="-390.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Collation</text></g><!-- coll_prot&#45;&gt;net_brdg --><g id="edge44" class="edge"><title>coll_prot&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1808.0236,-229.4579C1731.8273,-229.4579 1726.0413,-283.5519 1651.5236,-299.4579 1561.1239,-318.754 1533.2095,-321.9125 1443.5421,-299.4579 1379.5063,-283.422 1378.5552,-229.4579 1312.5421,-229.4579"/><text text-anchor="middle" x="1547.5329" y="-319.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- coll_prot&#45;&gt;net_brdg --><g id="edge45" class="edge"><title>coll_prot&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1808.0236,-229.4579C1737.9587,-229.0276 1721.4621,-244.228 1651.5236,-248.4579 1559.256,-254.0383 1535.7387,-255.1091 1443.5421,-248.4579 1384.8632,-244.2247 1371.3722,-229.0574 1312.5421,-229.4579"/><text text-anchor="middle" x="1547.5329" y="-257.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Declare</text></g><!-- coll_prot&#45;&gt;net_brdg --><g id="edge46" class="edge"><title>coll_prot&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1808.0236,-229.4579C1587.8396,-225.8242 1532.7193,-225.4303 1312.5421,-229.4579"/><text text-anchor="middle" x="1547.5329" y="-231.2579" font-family="Times,serif" font-size="14.00" fill="#000000">AdvertiseCollation</text></g><!-- coll_prot&#45;&gt;net_brdg --><g id="edge47" class="edge"><title>coll_prot&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1808.0236,-229.4579C1737.8551,-228.2461 1721.5466,-213.135 1651.5236,-208.4579 1559.2929,-202.2975 1535.6866,-201.1191 1443.5421,-208.4579 1384.7627,-213.1393 1371.4969,-228.3293 1312.5421,-229.4579"/><text text-anchor="middle" x="1547.5329" y="-212.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Collation</text></g><!-- coll_prot&#45;&gt;net_brdg --><g id="edge48" class="edge"><title>coll_prot&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M2497.1565,-290.6117C2482.5365,-287.9663 2467.0266,-285.3992 2452.5236,-283.4579 2170.9555,-245.7674 2097.1554,-225.3078 1818.0399,-229.3054"/><polygon fill="none" stroke="#000000" points="1817.9692,-225.8059 1808.0236,-229.4579 1818.0758,-232.8051 1817.9692,-225.8059"/><path fill="none" stroke="#000000" d="M1808.0236,-229.4579C1735.651,-229.0412 1723.1895,-194.5567 1651.5236,-184.4579 1559.9917,-171.5597 1534.7162,-169.2348 1443.5421,-184.4579 1382.8211,-194.5963 1374.0973,-228.5711 1312.5421,-229.4579"/><path fill="none" stroke="#000000" d="M1312.5421,-229.4579C1058.4194,-231.08 939.0558,-184.225 755.9631,-360.4579 702.5381,-411.8813 664.5619,-650.4893 654.7004,-718.3878"/><text text-anchor="middle" x="1547.5329" y="-188.2579" font-family="Times,serif" font-size="14.00" fill="#000000">RequestCollation</text></g><!-- net_brdg&#45;&gt;avail_dist --><g id="edge50" class="edge"><title>net_brdg&#45;&gt;avail_dist</title><path fill="none" stroke="#000000" d="M648.1748,-754.7222C635.171,-812.4566 592.356,-989.3374 548.3783,-1025.4579 498.713,-1066.2498 325.9028,-1058.6981 262.3783,-1068.4579 247.2971,-1070.7749 231.3079,-1073.2585 215.7327,-1075.6924"/><polygon fill="none" stroke="#000000" points="214.9098,-1072.2785 205.5711,-1077.2824 215.992,-1079.1944 214.9098,-1072.2785"/><text text-anchor="middle" x="405.3783" y="-1072.2579" font-family="Times,serif" font-size="14.00" fill="#000000">NetworkBridgeUpdate</text></g><!-- net_brdg&#45;&gt;bitf_dist --><g id="edge51" class="edge"><title>net_brdg&#45;&gt;bitf_dist</title><path fill="none" stroke="#000000" d="M723.4762,-746.4876C859.9928,-765.8781 1167.6413,-810.4845 1425.5421,-854.4579 1439.3044,-856.8044 1453.9127,-859.4361 1468.0577,-862.0583"/><polygon fill="none" stroke="#000000" points="1467.7845,-865.5677 1478.2569,-863.9618 1469.0688,-858.6865 1467.7845,-865.5677"/><text text-anchor="middle" x="1063.2526" y="-817.2579" font-family="Times,serif" font-size="14.00" fill="#000000">NetworkBridgeUpdate</text></g><!-- net_brdg&#45;&gt;coll_prot --><g id="edge54" class="edge"><title>net_brdg&#45;&gt;coll_prot</title><path fill="none" stroke="#000000" d="M653.9875,-718.2421C662.2048,-638.8532 698.0271,-323.5733 755.9631,-245.4579 848.8134,-120.2672 907.3876,-76.4579 1063.2526,-76.4579 1063.2526,-76.4579 1063.2526,-76.4579 2077.5236,-76.4579 2266.3854,-76.4579 2460.7449,-220.2079 2532.2536,-278.9222"/><polygon fill="none" stroke="#000000" points="2530.4257,-281.9536 2540.3565,-285.6456 2534.8956,-276.5665 2530.4257,-281.9536"/><text text-anchor="middle" x="1547.5329" y="-80.2579" font-family="Times,serif" font-size="14.00" fill="#000000">NetworkBridgeUpdate</text></g><!-- net_brdg&#45;&gt;pov_dist --><g id="edge52" class="edge"><title>net_brdg&#45;&gt;pov_dist</title><path fill="none" stroke="#000000" d="M655.8669,-718.3186C668.2802,-659.233 710.2706,-473.954 755.9631,-436.4579 909.7981,-310.2183 1001.0049,-389.0452 1199.5421,-375.4579 1352.9179,-364.9613 1866.295,-384.0923 1946.5236,-388.4579 1959.6899,-389.1743 1973.5853,-390.1276 1987.2103,-391.1744"/><polygon fill="none" stroke="#000000" points="1987.3158,-394.6935 1997.5601,-391.9907 1987.8663,-387.7152 1987.3158,-394.6935"/><text text-anchor="middle" x="1312.5421" y="-379.2579" font-family="Times,serif" font-size="14.00" fill="#000000">NetworkBridgeUpdate</text></g><!-- net_brdg&#45;&gt;stmt_dist --><g id="edge53" class="edge"><title>net_brdg&#45;&gt;stmt_dist</title><path fill="none" stroke="#000000" d="M688.8429,-720.111C708.3568,-712.2588 733.0054,-703.6587 755.9631,-699.4579 816.7423,-688.3364 885.4097,-686.0485 942.3934,-686.8783"/><polygon fill="none" stroke="#000000" points="942.4657,-690.3801 952.5269,-687.0602 942.5914,-683.3812 942.4657,-690.3801"/><text text-anchor="middle" x="841.4631" y="-703.2579" font-family="Times,serif" font-size="14.00" fill="#000000">NetworkBridgeUpdate</text></g><!-- pov_dist&#45;&gt;net_brdg --><g id="edge55" class="edge"><title>pov_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1547.5329,-450.4579C1332.6386,-462.5757 1278.3326,-442.2734 1063.2526,-450.4579"/><text text-anchor="middle" x="1312.5421" y="-458.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage</text></g><!-- pov_dist&#45;&gt;net_brdg --><g id="edge56" class="edge"><title>pov_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1991.3123,-395.9584C1908.2907,-394.1043 1779.472,-395.2187 1669.5236,-413.4579 1617.1237,-422.1504 1605.3936,-443.1017 1557.596,-449.4013"/><polygon fill="none" stroke="#000000" points="1557.1127,-445.9327 1547.5329,-450.4579 1557.8437,-452.8945 1557.1127,-445.9327"/><path fill="none" stroke="#000000" d="M1547.5329,-450.4579C1492.6917,-453.7832 1480.3028,-434.9171 1425.5421,-430.4579 1264.8114,-417.3696 1219.5931,-410.9193 1063.2526,-450.4579"/><path fill="none" stroke="#000000" d="M1063.2526,-450.4579C875.1331,-456.8647 711.1887,-656.9862 665.0751,-718.5898"/><text text-anchor="middle" x="1312.5421" y="-434.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- provisioner&#45;&gt;cand_back --><g id="edge57" class="edge"><title>provisioner&#45;&gt;cand_back</title><path fill="none" stroke="#000000" d="M2016.1689,-755.4699C1998.1153,-751.5801 1979.2719,-744.8856 1964.5236,-733.4579 1951.0081,-722.9853 1960.7939,-708.8762 1946.5236,-699.4579 1894.9719,-665.434 1729.3741,-691.7266 1669.5236,-676.4579 1641.7512,-669.3728 1612.323,-656.5191 1589.3295,-645.1295"/><polygon fill="#000000" stroke="#000000" points="1589.2975,-645.1134 1582.1373,-645.9683 1578.5942,-639.6876 1585.7544,-638.8327 1589.2975,-645.1134"/><text text-anchor="middle" x="1808.0236" y="-703.2579" font-family="Times,serif" font-size="14.00" fill="#000000">GetBackedCandidates</text></g><!-- provisioner&#45;&gt;chn_api --><g id="edge58" class="edge"><title>provisioner&#45;&gt;chn_api</title><path fill="none" stroke="#000000" d="M2119.7458,-774.0902C2214.8561,-804.904 2438.6932,-878.056 2452.5236,-888.4579 2497.237,-922.0868 2530.4291,-979.6255 2547.6259,-1014.3415"/><polygon fill="#000000" stroke="#000000" points="2547.8353,-1014.7773 2554.0399,-1018.452 2553.0342,-1025.5926 2546.8296,-1021.9179 2547.8353,-1014.7773"/><text text-anchor="middle" x="2330.5236" y="-892.2579" font-family="Times,serif" font-size="14.00" fill="#000000">BlockNumber</text></g><!-- stmt_dist&#45;&gt;cand_back --><g id="edge61" class="edge"><title>stmt_dist&#45;&gt;cand_back</title><path fill="none" stroke="#000000" d="M1099.0516,-676.2833C1126.0126,-664.2257 1164.243,-648.9639 1199.5421,-641.4579 1278.5129,-624.6656 1369.7043,-620.2168 1438.9208,-619.806"/><polygon fill="none" stroke="#000000" points="1438.9809,-623.3059 1448.9696,-619.7737 1438.9584,-616.3059 1438.9809,-623.3059"/><text text-anchor="middle" x="1312.5421" y="-645.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Statement</text></g><!-- stmt_dist&#45;&gt;net_brdg --><g id="edge59" class="edge"><title>stmt_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M1009.2728,-677.3689C946.9146,-661.4353 841.8742,-642.8214 755.9631,-668.4579 727.2437,-677.028 699.0852,-696.3666 679.3601,-712.2382"/><polygon fill="none" stroke="#000000" points="676.9192,-709.715 671.4458,-718.7865 681.3816,-715.1083 676.9192,-709.715"/><text text-anchor="middle" x="841.4631" y="-672.2579" font-family="Times,serif" font-size="14.00" fill="#000000">SendValidationMessage</text></g><!-- stmt_dist&#45;&gt;net_brdg --><g id="edge60" class="edge"><title>stmt_dist&#45;&gt;net_brdg</title><path fill="none" stroke="#000000" d="M983.3909,-706.7615C964.8979,-709.5645 945.2726,-712.3173 926.9631,-714.4579 866.4519,-721.5325 798.1746,-727.0111 744.8165,-730.7316"/><polygon fill="none" stroke="#000000" points="744.4276,-727.25 734.6918,-731.429 744.9087,-734.2335 744.4276,-727.25"/><text text-anchor="middle" x="841.4631" y="-734.2579" font-family="Times,serif" font-size="14.00" fill="#000000">ReportPeer</text></g><!-- stmt_dist&#45;&gt;runt_api --><g id="edge62" class="edge"><title>stmt_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1547.5329,-831.4579C1590.933,-836.1133 2287.985,-906.2409 2330.5236,-896.4579"/><path fill="none" stroke="#000000" d="M2330.5236,-896.4579C2383.5287,-883.4492 2401.1421,-900.8617 2452.5236,-882.4579 2481.9853,-871.9054 2511.5664,-852.0145 2532.3572,-836.1252"/><polygon fill="none" stroke="#000000" points="2534.7017,-838.7351 2540.4269,-829.8204 2530.392,-833.219 2534.7017,-838.7351"/><text text-anchor="middle" x="1808.0236" y="-872.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::Validators</text></g><!-- stmt_dist&#45;&gt;runt_api --><g id="edge63" class="edge"><title>stmt_dist&#45;&gt;runt_api</title><path fill="none" stroke="#000000" d="M1105.738,-710.3728C1188.888,-742.3888 1379.6701,-810.5141 1547.5329,-831.4579"/><path fill="none" stroke="#000000" d="M1547.5329,-831.4579C1601.3661,-838.6178 1615.2503,-826.3794 1669.5236,-824.4579 1968.3131,-813.8792 2323.7435,-812.4329 2480.1764,-812.3601"/><polygon fill="none" stroke="#000000" points="2480.6422,-815.86 2490.6412,-812.3571 2480.6402,-808.86 2480.6422,-815.86"/><text text-anchor="middle" x="1808.0236" y="-828.2579" font-family="Times,serif" font-size="14.00" fill="#000000">Request::SessionIndexForChild</text></g></g></svg></div>
<h2 id="the-path-to-inclusion-node-side"><a class="header" href="#the-path-to-inclusion-node-side">The Path to Inclusion (Node Side)</a></h2>
<p>Let's contextualize that diagram a bit by following a parachain block from its creation through finalization.
Parachains can use completely arbitrary processes to generate blocks. The relay chain doesn't know or care about
the details; each parachain just needs to provide a <a href="collators/collation-generation.html">collator</a>.</p>
<p><strong>Note</strong>: Inter-subsystem communications are relayed via the overseer, but that step is omitted here for brevity.</p>
<p><strong>Note</strong>: Dashed lines indicate a request/response cycle, where the response is communicated asynchronously via
a oneshot channel. Adjacent dashed lines may be processed in parallel.</p>
<pre class="mermaid">sequenceDiagram
    participant Overseer
    participant CollationGeneration
    participant RuntimeApi
    participant CollatorProtocol

    Overseer -&gt;&gt; CollationGeneration: ActiveLeavesUpdate
    loop for each activated head
        CollationGeneration --&gt;&gt; RuntimeApi: Request availability cores
        CollationGeneration --&gt;&gt; RuntimeApi: Request validators

        Note over CollationGeneration: Determine an appropriate ScheduledCore &lt;br/&gt;and OccupiedCoreAssumption

        CollationGeneration --&gt;&gt; RuntimeApi: Request full validation data

        Note over CollationGeneration: Build the collation

        CollationGeneration -&gt;&gt; CollatorProtocol: DistributeCollation
    end
</pre>
<p>The <code>DistributeCollation</code> messages that <code>CollationGeneration</code> sends to the <code>CollatorProtocol</code> contains
two items: a <code>CandidateReceipt</code> and <code>PoV</code>. The <code>CollatorProtocol</code> is then responsible for distributing
that collation to interested validators. However, not all potential collations are of interest. The
<code>CandidateSelection</code> subsystem is responsible for determining which collations are interesting, before
<code>CollatorProtocol</code> actually fetches the collation.</p>
<pre class="mermaid">sequenceDiagram
    participant CollationGeneration
    participant CS as CollatorProtocol::CollatorSide
    participant NB as NetworkBridge
    participant VS as CollatorProtocol::ValidatorSide
    participant CandidateSelection

    CollationGeneration -&gt;&gt; CS: DistributeCollation
    CS --&gt;&gt; NB: ConnectToValidators

    Note over CS,NB: This connects to multiple validators.

    CS -&gt;&gt; NB: Declare
    NB -&gt;&gt; VS: Declare

    Note over CS: Ensure that the connected validator is among&lt;br/&gt;the para's validator set. Otherwise, skip it.

    CS -&gt;&gt; NB: AdvertiseCollation
    NB -&gt;&gt; VS: AdvertiseCollation

    VS -&gt;&gt; CandidateSelection: Collation

    Note over CandidateSelection: Lots of other machinery in play here,&lt;br/&gt;but there are only three outcomes from the&lt;br/&gt;perspective of the `CollatorProtocol`:

    alt happy path
        CandidateSelection --&gt;&gt; VS: FetchCollation
        Activate VS
        VS -&gt;&gt; NB: RequestCollation
        NB -&gt;&gt; CS: RequestCollation
        CS -&gt;&gt; NB: Collation
        NB -&gt;&gt; VS: Collation
        Deactivate VS

    else collation invalid or unexpected
        CandidateSelection -&gt;&gt; VS: ReportCollator
        VS -&gt;&gt; NB: ReportPeer

    else CandidateSelection already selected a different candidate
        Note over CandidateSelection: silently drop
    end
</pre>
<p>Assuming we hit the happy path, flow continues with <code>CandidateSelection</code> receiving a <code>(candidate_receipt, pov)</code> as
the return value from its
<code>FetchCollation</code> request. The only time <code>CandidateSelection</code> actively requests a collation is when
it hasn't yet seconded one for some <code>relay_parent</code>, and is ready to second.</p>
<pre class="mermaid">sequenceDiagram
    participant CS as CandidateSelection
    participant CB as CandidateBacking
    participant CV as CandidateValidation
    participant PV as Provisioner
    participant SD as StatementDistribution
    participant PD as PoVDistribution

    CS -&gt;&gt; CB: Second
    % fn validate_and_make_available
    CB --&gt;&gt; CV: ValidateFromChainState

    Note over CB,CV: There's some complication in the source, as&lt;br/&gt;candidates are actually validated in a separate task.

    alt valid
        Note over CB: This is where we transform the CandidateReceipt into a CommittedCandidateReceipt
        % CandidateBackingJob::sign_import_and_distribute_statement
        % CandidateBackingJob::import_statement
        CB -&gt;&gt; PV: ProvisionableData::BackedCandidate
        % CandidateBackingJob::issue_new_misbehaviors
        opt if there is misbehavior to report
            CB -&gt;&gt; PV: ProvisionableData::MisbehaviorReport
        end
        % CandidateBackingJob::distribute_signed_statement
        CB -&gt;&gt; SD: Share
        % CandidateBackingJob::distribute_pov
        CB -&gt;&gt; PD: DistributePoV
    else invalid
        CB -&gt;&gt; CS: Invalid
    end
</pre>
<p>At this point, you'll see that control flows in two directions: to <code>StatementDistribution</code> to distribute
the <code>SignedStatement</code>, and to <code>PoVDistribution</code> to distribute the <code>PoV</code>. However, that's largely a mirage:
while the initial implementation distributes <code>PoV</code>s by gossip, that's inefficient, and will be replaced
with a system which fetches <code>PoV</code>s only when actually necessary.</p>
<blockquote>
<p>TODO: figure out more precisely the current status and plans; write them up</p>
</blockquote>
<p>Therefore, we'll follow the <code>SignedStatement</code>. The <code>StatementDistribution</code> subsystem is largely concerned
with implementing a gossip protocol:</p>
<pre class="mermaid">sequenceDiagram
    participant SD as StatementDistribution
    participant NB as NetworkBridge

    alt On receipt of a&lt;br/&gt;SignedStatement from CandidateBacking
        % fn circulate_statement_and_dependents
        SD -&gt;&gt; NB: SendValidationMessage

        Note right of NB: Bridge sends validation message to all appropriate peers
    else On receipt of peer validation message
        NB -&gt;&gt; SD: NetworkBridgeUpdate

        % fn handle_incoming_message
        alt if we aren't already aware of the relay parent for this statement
            SD -&gt;&gt; NB: ReportPeer
        end

        % fn circulate_statement
        opt if we know of peers who haven't seen this message, gossip it
            SD -&gt;&gt; NB: SendValidationMessage
        end
    end
</pre>
<p>But who are these <code>Listener</code>s who've asked to be notified about incoming <code>SignedStatement</code>s?
Nobody, as yet.</p>
<p>Let's pick back up with the PoV Distribution subsystem.</p>
<pre class="mermaid">sequenceDiagram
    participant CB as CandidateBacking
    participant PD as PoVDistribution
    participant Listener
    participant NB as NetworkBridge

    CB -&gt;&gt; PD: DistributePoV

    Note over PD,Listener: Various subsystems can register listeners for when PoVs arrive

    loop for each Listener
        PD -&gt;&gt; Listener: Arc&lt;PoV&gt;
    end

    Note over PD: Gossip to connected peers

    PD -&gt;&gt; NB: SendPoV

    Note over PD,NB: On receipt of a network PoV, PovDistribution forwards it to each Listener.&lt;br/&gt;It also penalizes bad gossipers.
</pre>
<p>Unlike in the case of <code>StatementDistribution</code>, there is another subsystem which in various circumstances
already registers a listener to be notified when a new <code>PoV</code> arrives: <code>CandidateBacking</code>. Note that this
is the second time that <code>CandidateBacking</code> has gotten involved. The first instance was from the perspective
of the validator choosing to second a candidate via its <code>CandidateSelection</code> subsystem. This time, it's
from the perspective of some other validator, being informed that this foreign <code>PoV</code> has been received.</p>
<pre class="mermaid">sequenceDiagram
    participant SD as StatementDistribution
    participant CB as CandidateBacking
    participant PD as PoVDistribution
    participant AS as AvailabilityStore

    SD -&gt;&gt; CB: Statement
    % CB::maybe_validate_and_import =&gt; CB::kick_off_validation_work
    CB --&gt;&gt; PD: FetchPoV
    Note over CB,PD: This call creates the Listener from the previous diagram

    CB -&gt;&gt; AS: StoreAvailableData
</pre>
<p>At this point, things have gone a bit nonlinear. Let's pick up the thread again with <code>BitfieldSigning</code>. As
the <code>Overseer</code> activates each relay parent, it starts a <code>BitfieldSigningJob</code> which operates on an extremely
simple metric: after creation, it immediately goes to sleep for 1.5 seconds. On waking, it records the state
of the world pertaining to availability at that moment.</p>
<pre class="mermaid">sequenceDiagram
    participant OS as Overseer
    participant BS as BitfieldSigning
    participant RA as RuntimeApi
    participant AS as AvailabilityStore
    participant BD as BitfieldDistribution

    OS -&gt;&gt; BS: ActiveLeavesUpdate
    loop for each activated relay parent
        Note over BS: Wait 1.5 seconds
        BS --&gt;&gt; RA: Request::AvailabilityCores
        loop for each availability core
            BS --&gt;&gt; AS: QueryChunkAvailability
        end
        BS -&gt;&gt; BD: DistributeBitfield
    end
</pre>
<p><code>BitfieldDistribution</code> is, like the other <code>*Distribution</code> subsystems, primarily interested in implementing
a peer-to-peer gossip network propagating its particular messages. However, it also serves as an essential
relay passing the message along.</p>
<pre class="mermaid">sequenceDiagram
    participant BS as BitfieldSigning
    participant BD as BitfieldDistribution
    participant NB as NetworkBridge
    participant PV as Provisioner

    BS -&gt;&gt; BD: DistributeBitfield
    BD -&gt;&gt; PV: ProvisionableData::Bitfield
    BD -&gt;&gt; NB: SendValidationMessage::BitfieldDistribution::Bitfield
</pre>
<p>We've now seen the message flow to the <code>Provisioner</code>: both <code>CandidateBacking</code> and <code>BitfieldDistribution</code>
contribute provisionable data. Now, let's look at that subsystem.</p>
<p>Much like the <code>BitfieldSigning</code> subsystem, the <code>Provisioner</code> creates a new job for each newly-activated
leaf, and starts a timer. Unlike <code>BitfieldSigning</code>, we won't depict that part of the process, because
the <code>Provisioner</code> also has other things going on.</p>
<pre class="mermaid">sequenceDiagram
    participant A as Arbitrary
    participant PV as Provisioner
    participant CB as CandidateBacking
    participant BD as BitfieldDistribution
    participant RA as RuntimeApi
    participant PI as ParachainsInherentDataProvider

    alt receive provisionable data
        alt
            CB -&gt;&gt; PV: ProvisionableData
        else
            BD -&gt;&gt; PV: ProvisionableData
        end

        loop over stored Senders
            PV -&gt;&gt; A: ProvisionableData
        end

        Note over PV: store bitfields and backed candidates
    else receive request for inherent data
        PI -&gt;&gt; PV: RequestInherentData
        alt we have already constructed the inherent data
            PV -&gt;&gt; PI: send the inherent data
        else we have not yet constructed the inherent data
            Note over PV,PI: Store the return sender without sending immediately
        end
    else timer times out
        note over PV: Waited 2 seconds
        PV --&gt;&gt; RA: RuntimeApiRequest::AvailabilityCores
        Note over PV: construct and store the inherent data
        loop over stored inherent data requests
            PV -&gt;&gt; PI: (SignedAvailabilityBitfields, BackedCandidates)
        end
    end
</pre>
<p>In principle, any arbitrary subsystem could send a <code>RequestInherentData</code> to the <code>Provisioner</code>. In practice,
only the <code>ParachainsInherentDataProvider</code> does so.</p>
<p>The tuple <code>(SignedAvailabilityBitfields, BackedCandidates, ParentHeader)</code> is injected by the <code>ParachainsInherentDataProvider</code>
into the inherent data. From that point on, control passes from the node to the runtime.</p>
<footer id="last-change">Last change: %cs, commit: <a href="https://github.com/paritytech/polkadot/commit/f7bf844553">f7bf844553</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../node/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../node/overseer.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../node/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../node/overseer.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
